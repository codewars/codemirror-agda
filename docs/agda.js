(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(require('codemirror')) :
  typeof define === 'function' && define.amd ? define(['codemirror'], factory) :
  (global = global || self, factory(global.CodeMirror));
}(this, function (CodeMirror) { 'use strict';

  CodeMirror = CodeMirror && CodeMirror.hasOwnProperty('default') ? CodeMirror['default'] : CodeMirror;

  // Requires addon/mode/simple.js

  const floatRegex = /-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?(?=[.;{}()@"\s]|$)/u;
  const integerRegex = /-?(?:0|[1-9]\d*|0x[0-9A-Fa-f]+)(?=[.;{}()@"\s]|$)/u;

  const keywordsRegex = new RegExp(
    "(?:[_=|â†’:?\\\\Î»âˆ€]|->|\\.{2,3}|abstract|codata|coinductive|constructor|" +
      "data|do|eta-equality|field|forall|hiding|import|in|inductive|" +
      "infix|infixl|infixr|instance|let|macro|module|mutual|no-eta-equality|" +
      "open|overlap|pattern|postulate|primitive|private|public|quote|" +
      "quoteContext|quoteGoal|quoteTerm|record|renaming|rewrite|" +
      "syntax|tactic|unquote|unquoteDecl|unquoteDef|using|where|with|" +
      'Set(?:\\d+|[â‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰]+)?)(?=[.;{}()@"\\s]|$)',
    "u"
  );

  const escapeDec = "0|[1-9]\\d*";
  const escapeHex = "x(?:0|[1-9A-Fa-f][0-9A-Fa-f]*)";
  const escapeCode =
    "[abtnvf&\\\\'\"]|NUL|SOH|STX|ETX|EOT|ENQ|ACK|BEL|BS|HT|LF|VT|FF|CR|" +
    "SO|SI|DLE|DC[1-4]|NAK|SYN|ETB|CAN|EM|SUB|ESC|FS|GS|RS|US|SP|DEL";
  const escapeChar = new RegExp(
    "\\\\(?:" + escapeDec + "|" + escapeHex + "|" + escapeCode + ")",
    "u"
  );

  const startState = [
    // comments, pragmas, holes
    { regex: /\{-#.*?#-\}/u, token: "meta" },
    { regex: /\{-/u, token: "comment", push: "comment" },
    { regex: /\{!/u, token: "keyword", push: "hole" },
    { regex: /--.*/u, token: "comment" },

    // literals
    { regex: floatRegex, token: "number" },
    { regex: integerRegex, token: "integer" },
    { regex: /'/u, token: "string", push: "charLit" },
    { regex: /"/u, token: "string", push: "strLit" },

    // keywords & qualified names
    { regex: keywordsRegex, token: "keyword" },
    { regex: /[^\s.;{}()@"]+\./u, token: "qualifier" },
    { regex: /[^\s.;{}()@"]+/u, token: null },
  ];

  const commentState = [
    { regex: /\{-/u, token: "comment", push: "comment" },
    { regex: /-\}/u, token: "comment", pop: true },
    { regex: /./u, token: "comment" },
  ];

  const holeState = [
    { regex: /\{!/u, token: "keyword", push: "hole" },
    { regex: /!\}/u, token: "keyword", pop: true },
    { regex: /./u, token: "comment" },
  ];

  const charLitState = [
    { regex: /'/u, token: "string error", pop: true },
    { regex: /[^'\\]/u, token: "string", next: "charLitEnd" },
    { regex: escapeChar, token: "string", next: "charLitEnd" },
    { regex: /./u, token: "string error" },
  ];

  const charLitEndState = [
    { regex: /'/u, token: "string", pop: true },
    { regex: /./u, token: "string error" },
    { regex: /[^]/u, token: "string error", pop: true },
  ];

  const stringState = [
    { regex: /"/u, token: "string", pop: true },
    { regex: /[^"\\]/u, token: "string" },
    { regex: escapeChar, token: "string" },
    { regex: /./u, token: "string error" },
  ];

  CodeMirror.defineSimpleMode("agda", {
    start: startState,
    comment: commentState,
    hole: holeState,
    charLit: charLitState,
    charLitEnd: charLitEndState,
    strLit: stringState,
  });
  CodeMirror.defineMIME("text/x-agda", "agda");

  const cmObj = (k, v) => ({
    text: "\\" + k,
    symbol: v,
    displayText: `${v} \\${k}`,
    hint: null,
  });

  const toTable = pairs =>
    pairs.reduce((a, p) => {
      a.push.apply(
        a,
        Array.from(p[1].replace(/\s/g, "")).map(v => cmObj(p[0], v))
      );
      return a;
    }, []);

  // Subset of agda-input-translations + TeX-Input
  // TODO Add some more from TeX-Input
  // https://github.com/agda/agda/blob/master/src/data/emacs-mode/agda-input.el#L191
  const translations = toTable([
    ["ell", "â„“"],
    // Equality and similar symbols.
    ["eq", "=âˆ¼âˆ½â‰ˆâ‰‹âˆ»âˆ¾âˆ¿â‰€â‰ƒâ‹â‰‚â‰… â‰Œâ‰Šâ‰¡â‰£â‰â‰‘â‰’â‰“â‰”â‰•â‰–â‰—â‰˜â‰™â‰šâ‰›â‰œâ‰â‰â‰Ÿâ‰â‰â‰â‰¬â‹•"],
    ["eqn", "â‰ â‰ â‰‰     â‰„  â‰‡â‰†  â‰¢                 â‰­    "],
    ["=", "="],
    ["=n", "â‰ "],
    ["~", "âˆ¼"],
    ["~n", "â‰"],
    ["~~", "â‰ˆ"],
    ["~~n", "â‰‰"],

    // ["~~~", "â‰‹"],
    // [":~", "âˆ»"],
    ["~-", "â‰ƒ"],
    ["~-n", "â‰„"],
    ["-~", "â‰‚"],
    ["~=", "â‰…"],
    ["~=n", "â‰‡"],
    ["~~-", "â‰Š"],
    ["==", "â‰¡"],
    ["==n", "â‰¢"],
    // ["===", "â‰£"],
    // [".=", "â‰"],
    // [".=.", "â‰‘"],
    // [":=", "â‰”"],
    // ["=:", "â‰•"],
    // ["=o", "â‰—"],
    // ["(=", "â‰˜"],
    // ["and=", "â‰™"],
    // ["or=", "â‰š"],
    // ["*=", "â‰›"],
    // ["t=", "â‰œ"],
    // ["def=", "â‰"],
    // ["m=", "â‰"],
    // ["?=", "â‰Ÿ"],

    // Inequality and similar symbols.
    ["leq", "<â‰ªâ‹˜â‰¤â‰¦â‰² â‰¶â‰ºâ‰¼â‰¾âŠ‚âŠ† â‹âŠâŠ‘ âŠ°âŠ²âŠ´â‹–â‹šâ‹œâ‹"],
    ["leqn", "â‰®  â‰°â‰¨â‰´â‹¦â‰¸âŠ€ â‹¨âŠ„âŠˆâŠŠ  â‹¢â‹¤ â‹ªâ‹¬   â‹ "],
    ["geq", ">â‰«â‹™â‰¥â‰§â‰³ â‰·â‰»â‰½â‰¿âŠƒâŠ‡ â‹‘âŠâŠ’ âŠ±âŠ³âŠµâ‹—â‹›â‹â‹Ÿ"],
    ["geqn", "â‰¯  â‰±â‰©â‰µâ‹§â‰¹âŠ â‹©âŠ…âŠ‰âŠ‹  â‹£â‹¥ â‹«â‹­   â‹¡"],
    ["<=", "â‰¤"],
    [">=", "â‰¥"],
    ["<=n", "â‰°"],
    [">=n", "â‰±"],
    ["le", "â‰¤"],
    ["ge", "â‰¥"],
    ["len", "â‰°"],
    ["gen", "â‰±"],
    ["<n", "â‰®"],
    [">n", "â‰¯"],
    ["<~", "â‰²"],
    [">~", "â‰³"],
    // ["<~n", "â‹¦"],
    // [">~n", "â‹§"],
    // ["<~nn", "â‰´"],
    // [">~nn", "â‰µ"],
    ["sub", "âŠ‚"],
    ["sup", "âŠƒ"],
    ["subn", "âŠ„"],
    ["supn", "âŠ…"],
    ["sub=", "âŠ†"],
    ["sup=", "âŠ‡"],
    ["sub=n", "âŠˆ"],
    ["sup=n", "âŠ‰"],
    // ["squb", "âŠ"],
    // ["squp", "âŠ"],
    // ["squb=", "âŠ‘"],
    // ["squp=", "âŠ’"],
    // ["squb=n", "â‹¢"],
    // ["squp=n", "â‹£"],

    // Set membership etc.
    // ["member", "âˆˆâˆ‰âˆŠâˆ‹âˆŒâˆâ‹²â‹³â‹´â‹µâ‹¶â‹·â‹¸â‹¹â‹ºâ‹»â‹¼â‹½â‹¾â‹¿"],
    ["in", "âˆˆ"],
    ["inn", "âˆ‰"],
    ["ni", "âˆ‹"],
    ["nin", "âˆŒ"],

    // Intersections, unions etc.
    // ["intersection", "âˆ©â‹‚âˆ§â‹€â‹â¨‡âŠ“â¨…â‹’âˆ âŠ¼      â¨‰"],
    // ["union", "âˆªâ‹ƒâˆ¨â‹â‹â¨ˆâŠ”â¨†â‹“âˆâ¨¿âŠ½âŠ»âŠâ¨ƒâŠâ¨„âŠŒâˆ‘â…€"],

    ["and", "âˆ§"],
    ["or", "âˆ¨"],
    ["And", "â‹€"],
    ["Or", "â‹"],
    // ["i", "âˆ©"],
    // ["un", "âˆª"],
    // ["u+", "âŠ"],
    // ["u.", "âŠ"],
    // ["I", "â‹‚"],
    // ["Un", "â‹ƒ"],
    // ["U+", "â¨„"],
    // ["U.", "â¨ƒ"],
    ["glb", "âŠ“"],
    ["lub", "âŠ”"],
    // ["Glb", "â¨…"],
    // ["Lub", "â¨†"],

    // Entailment etc.
    // ["entails", "âŠ¢âŠ£âŠ¤âŠ¥âŠ¦âŠ§âŠ¨âŠ©âŠªâŠ«âŠ¬âŠ­âŠ®âŠ¯"],
    ["|-", "âŠ¢"],
    ["vdash", "âŠ¢"],
    // ["|-n", "âŠ¬"],
    // ["-|", "âŠ£"],
    // ["|=", "âŠ¨"],
    // ["|=n", "âŠ­"],
    // ["||-", "âŠ©"],
    // ["||-n", "âŠ®"],
    // ["||=", "âŠ«"],
    // ["||=n", "âŠ¯"],
    // ["|||-", "âŠª"],

    // Divisibility, parallelity.
    ["|", "âˆ£"],
    ["|n", "âˆ¤"],
    ["||", "âˆ¥"],
    ["||n", "âˆ¦"],

    // Some symbols from logic and set theory.
    ["all", "âˆ€"],
    ["ex", "âˆƒ"],
    ["exn", "âˆ„"],
    ["0", "âˆ…"],
    ["C", "âˆ"],

    // Corners, ceilings and floors.
    // ["c", "âŒœâŒâŒâŒŸâŒˆâŒ‰âŒŠâŒ‹"],
    // ["cu", "âŒœâŒ  âŒˆâŒ‰  "],
    // ["cl", "  âŒâŒŸ  âŒŠâŒ‹"],
    // ["cul", "âŒœ"],
    // ["cuL", "âŒˆ"],
    // ["cur", "âŒ"],
    // ["cuR", "âŒ‰"],
    // ["cll", "âŒ"],
    // ["clL", "âŒŠ"],
    // ["clr", "âŒŸ"],
    // ["clR", "âŒ‹"],

    // Various operators/symbols.
    // ["qed", "âˆ"],
    ["x", "Ã—"],
    ["o", "âˆ˜"],
    ["comp", "âˆ˜"],
    [".", "âˆ™"],
    ["*", "â‹†"],
    // [".+", "âˆ”"],
    // [".-", "âˆ¸"],
    // [":", "âˆ¶â¦‚Ëê‰Ë¸á¥á¦ï¼šï¹•ï¸“"],
    // [",", "Ê»ØŒâ¸²â¸´â¹â¹‰ã€ï¸ï¸‘ï¹ï¹‘ï¼Œï½¤"],
    // [";", "Ø›âá¤ê›¶ï¼›ï¸”ï¹”â®â¸µÍ¾"],
    ["::", "âˆ·"],
    // ["::-", "âˆº"],
    // ["-:", "âˆ¹"],
    // ["+ ", "âŠ¹"],
    // ["surd3", "âˆ›"],
    // ["surd4", "âˆœ"],
    // ["increment", "âˆ†"],
    ["inf", "âˆ"],
    // ["&", "â…‹"],
    ["top", "âŠ¤"],
    ["bot", "âŠ¥"],

    // Circled operators.
    // ["o+", "âŠ•"],
    // ["o--", "âŠ–"],
    // ["ox", "âŠ—"],
    // ["o/", "âŠ˜"],
    // ["o.", "âŠ™"],
    // ["oo", "âŠš"],
    // ["o*", "âŠ›"],
    // ["o=", "âŠœ"],
    // ["o-", "âŠ"],
    // ["O+", "â¨"],
    // ["Ox", "â¨‚"],
    // ["O.", "â¨€"],
    // ["O*", "âŸ"],

    // Boxed operators.
    // ["b+", "âŠ"],
    // ["b-", "âŠŸ"],
    // ["bx", "âŠ "],
    // ["b.", "âŠ¡"],

    // Various symbols.
    // ["integral", "âˆ«âˆ¬âˆ­âˆ®âˆ¯âˆ°âˆ±âˆ²âˆ³"],
    // ["angle", "âˆŸâˆ¡âˆ¢âŠ¾âŠ¿"],
    // ["join", "â‹ˆâ‹‰â‹Šâ‹‹â‹Œâ¨âŸ•âŸ–âŸ—"],

    // Arrows.
    // ["l", "â†â‡â‡šâ‡‡â‡†â†¤â‡¦â†â†¼â†½â‡ â‡ºâ†œâ‡½âŸµâŸ¸â†šâ‡â‡· â†¹     â†¢â†©â†«â‡‹â‡œâ‡¤âŸ»âŸ½â¤†â†¶â†ºâŸ² "],
    // ["r", "â†’â‡’â‡›â‡‰â‡„â†¦â‡¨â† â‡€â‡â‡¢â‡»â†â‡¾âŸ¶âŸ¹â†›â‡â‡¸â‡¶ â†´    â†£â†ªâ†¬â‡Œâ‡â‡¥âŸ¼âŸ¾â¤‡â†·â†»âŸ³â‡°â‡´âŸ´âŸ¿ âµâ¸â™â”â›âœâââŸâ â¡â¢â£â¤â§â¨â©âªâ«â¬â­â®â¯â±â²â³âºâ»â¼â½â¾âŠ¸"],
    // ["u", "â†‘â‡‘âŸ°â‡ˆâ‡…â†¥â‡§â†Ÿâ†¿â†¾â‡¡â‡          â†°â†±â¦ â‡ªâ‡«â‡¬â‡­â‡®â‡¯                                           "],
    // ["d", "â†“â‡“âŸ±â‡Šâ‡µâ†§â‡©â†¡â‡ƒâ‡‚â‡£â‡Ÿ         â†µâ†²â†³â¥ â†¯                                                "],
    // ["ud", "â†•â‡•   â†¨â‡³                                                                    "],
    // ["lr", "â†”â‡”         â‡¼â†­â‡¿âŸ·âŸºâ†®â‡â‡¹                                                        "],
    // ["ul", "â†–â‡–                        â‡±â†¸                                               "],
    // ["ur", "â†—â‡—                                         â¶â¹âš                             "],
    // ["dr", "â†˜â‡˜                        â‡²                â´â·â˜                             "],
    // ["dl", "â†™â‡™                                                                         "],
    ["l-", "â†"],
    ["<-", "â†"],
    ["l=", "â‡"],
    ["r-", "â†’"],
    ["->", "â†’"],
    ["r=", "â‡’"],
    ["=>", "â‡’"],
    // ["u-", "â†‘"], ["u=", "â‡‘"],
    // ["d-", "â†“"], ["d=", "â‡“"],
    // ["ud-", "â†•"], ["ud=", "â‡•"],
    ["lr-", "â†”"],
    ["<->", "â†”"],
    // ["lr=", "â‡”"],
    ["<=>", "â‡”"],
    // ["ul-", "â†–"], ["ul=", "â‡–"],
    // ["ur-", "â†—"], ["ur=", "â‡—"],
    // ["dr-", "â†˜"], ["dr=", "â‡˜"],
    // ["dl-", "â†™"], ["dl=", "â‡™"],

    // ["l==", "â‡š"],
    // ["l-2", "â‡‡"],
    ["l-r-", "â‡†"],
    // ["r==", "â‡›"],
    // ["r-2", "â‡‰"],
    // ["r-3", "â‡¶"],
    // ["r-l-", "â‡„"],
    // ["u==", "âŸ°"],
    // ["u-2", "â‡ˆ"],
    // ["u-d-", "â‡…"],
    // ["d==", "âŸ±"],
    // ["d-2", "â‡Š"],
    // ["d-u-", "â‡µ"],

    // ["l--", "âŸµ"],
    // ["<--", "âŸµ"],
    // ["l~", "â†œâ‡œ"],
    // ["r--", "âŸ¶"],
    // ["-->", "âŸ¶"],
    // ["r~", "â†â‡âŸ¿"],
    // ["lr--", "âŸ·"],
    // ["<-->", "âŸ·"],
    // ["lr~", "â†­"],

    // ["l-n", "â†š"],
    // ["<-n", "â†š"],
    // ["l=n", "â‡"],
    // ["r-n", "â†›"],
    // ["->n", "â†›"],
    // ["r=n", "â‡"],
    // ["=>n", "â‡"],
    // ["lr-n", "â†®"],
    // ["<->n", "â†®"],
    // ["lr=n", "â‡"],
    // ["<=>n", "â‡"],

    // ["l-|", "â†¤"],
    // ["ll-", "â†"],
    ["r-|", "â†¦"],
    ["mapsto", "â†¦"],
    // ["rr-", "â† "],
    // ["u-|", "â†¥"],
    // ["uu-", "â†Ÿ"],
    // ["d-|", "â†§"],
    // ["dd-", "â†¡"],
    // ["ud-|", "â†¨"],

    // ["l->", "â†¢"],
    // ["r->", "â†£"],

    // ["r-o", "âŠ¸"],
    // ["-o", "âŠ¸"],

    // ["dz", "â†¯"],

    // Ellipsis.
    ["...", "â‹¯â‹®â‹°â‹±"],

    // Box-drawing characters.
    // ["---", "â”€â”‚â”Œâ”â””â”˜â”œâ”¤â”¬â”¼â”´â•´â•µâ•¶â•·â•­â•®â•¯â•°â•±â•²â•³"],
    // ["--=", "â•â•‘â•”â•—â•šâ•â• â•£â•¦â•¬â•©     â•’â••â•˜â•›â•â•¡â•¤â•ªâ•§ â•“â•–â•™â•œâ•Ÿâ•¢â•¥â•«â•¨"],
    // ["--_", "â”â”ƒâ”â”“â”—â”›â”£â”«â”³â•‹â”»â•¸â•¹â•ºâ•» â”â”¯â”‘â”•â”·â”™â”â”¿â”¥â”â”°â”’â”–â”¸â”šâ” â•‚â”¨â”â•€â”¦â”Ÿâ•â”§â”¢â•ˆâ”ªâ”¡â•‡â”© â”®â”­â”¶â”µâ”¾â”½â”²â”±â”ºâ”¹â•Šâ•‰â•†â•…â•„â•ƒ â•¿â•½â•¼â•¾"],
    // ["--.", "â•Œâ•â”„â”†â”ˆâ”Š â•â•â”…â”‡â”‰â”‹"],

    // Triangles.
    // Big/small, black/white.
    // ["t", "â—‚â—ƒâ—„â—…â–¸â–¹â–ºâ–»â–´â–µâ–¾â–¿â—¢â—¿â—£â—ºâ—¤â—¸â—¥â—¹"],
    // ["T", "â—€â—â–¶â–·â–²â–³â–¼â–½â—¬â—­â—®"],
    // ["tb", "â—‚â–¸â–´â–¾â—„â–ºâ—¢â—£â—¤â—¥"],
    // ["tw", "â—ƒâ–¹â–µâ–¿â—…â–»â—¿â—ºâ—¸â—¹"],
    // ["Tb", "â—€â–¶â–²â–¼"],
    // ["Tw", "â—â–·â–³â–½"],

    // Squares.
    // ["sq", "â– â–¡â—¼â—»â—¾â—½â–£â–¢â–¤â–¥â–¦â–§â–¨â–©â—§â—¨â—©â—ªâ—«â—°â—±â—²â—³"],
    // ["sqb", "â– â—¼â—¾"],
    // ["sqw", "â–¡â—»â—½"],
    // ["sq.", "â–£"],
    // ["sqo", "â–¢"],

    // Rectangles.
    // ["re", "â–¬â–­â–®â–¯"],
    // ["reb", "â–¬â–®"],
    // ["rew", "â–­â–¯"],

    // Parallelograms.
    // ["pa", "â–°â–±"],
    // ["pab", "â–°"],
    // ["paw", "â–±"],

    // Diamonds.
    // ["di", "â—†â—‡â—ˆ"],
    // ["dib", "â—†"],
    // ["diw", "â—‡"],
    // ["di.", "â—ˆ"],

    // Circles.
    // ["ci", "â—â—‹â—â—Œâ—¯â—â—â—‘â—’â—“â—”â—•â—–â——â— â—¡â—´â—µâ—¶â—·âš†âš‡âšˆâš‰"],
    // ["cib", "â—"],
    // ["ciw", "â—‹"],
    // ["ci.", "â—"],
    // ["ci..", "â—Œ"],
    // ["ciO", "â—¯"],

    // Stars.
    // ["st", "â‹†âœ¦âœ§âœ¶âœ´âœ¹ â˜…â˜†âœªâœ«âœ¯âœ°âœµâœ·âœ¸"],
    // ["st4", "âœ¦âœ§"],
    // ["st6", "âœ¶"],
    // ["st8", "âœ´"],
    // ["st12", "âœ¹"],

    // Blackboard bold letters.
    // ["bA", "ğ”¸"], ["bB", "ğ”¹"], ["bC", "â„‚"], ["bD", "ğ”»"],
    // ["bE", "ğ”¼"], ["bF", "ğ”½"], ["bG", "ğ”¾"], ["bH", "â„"],
    // ["bI", "ğ•€"], ["bJ", "ğ•"], ["bK", "ğ•‚"], ["bL", "ğ•ƒ"],
    // ["bM", "ğ•„"],
    ["bN", "â„•"],
    // ["bO", "ğ•†"],
    // ["bP", "â„™"],
    // ["bQ", "â„š"], ["bR", "â„"], ["bS", "ğ•Š"], ["bT", "ğ•‹"],
    // ["bU", "ğ•Œ"], ["bV", "ğ•"], ["bW", "ğ•"], ["bX", "ğ•"],
    // ["bY", "ğ•"],
    ["bZ", "â„¤"],
    // ["bGG", "â„¾"], ["bGP", "â„¿"], ["bGS", "â…€"],
    // ["ba", "ğ•’"], ["bb", "ğ•“"], ["bc", "ğ•”"], ["bd", "ğ••"],
    // ["be", "ğ•–"], ["bf", "ğ•—"], ["bg", "ğ•˜"], ["bh", "ğ•™"],
    // ["bi", "ğ•š"], ["bj", "ğ•›"], ["bk", "ğ•œ"], ["bl", "ğ•"],
    // ["bm", "ğ•"], ["bn", "ğ•Ÿ"], ["bo", "ğ• "], ["bp", "ğ•¡"],
    // ["bq", "ğ•¢"], ["br", "ğ•£"], ["bs", "ğ•¤"], ["bt", "ğ•¥"],
    // ["bu", "ğ•¦"], ["bv", "ğ•§"], ["bw", "ğ•¨"], ["bx", "ğ•©"],
    // ["by", "ğ•ª"], ["bz", "ğ•«"],
    // ["bGg", "â„½"], ["bGp", "â„¼"],

    // Blackboard bold numbers.
    // ["b0", "ğŸ˜"],
    // ["b1", "ğŸ™"], ["b2", "ğŸš"], ["b3", "ğŸ›"],
    // ["b4", "ğŸœ"], ["b5", "ğŸ"], ["b6", "ğŸ"],
    // ["b7", "ğŸŸ"], ["b8", "ğŸ "], ["b9", "ğŸ¡"],

    // Mathematical bold digits.
    // ["B0", "ğŸ"],
    // ["B1", "ğŸ"], ["B2", "ğŸ"], ["B3", "ğŸ‘"],
    // ["B4", "ğŸ’"], ["B5", "ğŸ“"], ["B6", "ğŸ”"],
    // ["B7", "ğŸ•"], ["B8", "ğŸ–"], ["B9", "ğŸ—"],

    // Parentheses.
    ["(", "([{â…â½â‚âŒ©â´âŸ…âŸ¦âŸ¨âŸªâ¦ƒã€ˆã€Šã€Œã€ã€ã€”ã€–ã€šï¸µï¸·ï¸¹ï¸»ï¸½ï¸¿ï¹ï¹ƒï¹™ï¹›ï¹ï¼ˆï¼»ï½›ï½¢"],
    [")", ")]}â†â¾â‚âŒªâµâŸ†âŸ§âŸ©âŸ«â¦„ã€‰ã€‹ã€ã€ã€‘ã€•ã€—ã€›ï¸¶ï¸¸ï¸ºï¸¼ï¸¾ï¹€ï¹‚ï¹„ï¹šï¹œï¹ï¼‰ï¼½ï½ï½£"],
    ["[[", "âŸ¦"],
    ["]]", "âŸ§"],
    ["<", "âŸ¨"],
    [">", "âŸ©"],
    ["<<", "âŸª"],
    [">>", "âŸ«"],
    ["{{", "â¦ƒ"],
    ["}}", "â¦„"],

    // ["(b", "âŸ…"],
    // [")b", "âŸ†"],
    // ["lbag", "âŸ…"],
    // ["rbag", "âŸ†"],
    // ["(|", "â¦‡"], // Idiom brackets
    // ["|)", "â¦ˆ"],
    // ["((", "â¦…"], // Banana brackets
    // ["))", "â¦†"],

    // Primes.
    ["'", "â€²â€³â€´â—"],
    ["'1", "â€²"],
    ["`", "â€µâ€¶â€·"],

    // Fractions.
    // ["frac", "Â¼Â½Â¾â…“â…”â…•â…–â…—â…˜â…™â…šâ…›â…œâ…â…â…Ÿ"],

    // Bullets.
    // ["bu", "â€¢â—¦â€£âŒâ"],
    // ["bub", "â€¢"],
    // ["buw", "â—¦"],
    // ["but", "â€£"],

    // Musical symbols.
    // ["note", "â™©â™ªâ™«â™¬"],
    ["b", "â™­"],
    ["#", "â™¯"],

    // Other punctuation and symbols.
    ["\\", "\\"],
    // ["en", "â€“"],
    // ["em", "â€”"],
    // ["!!", "â€¼"],
    // ["??", "â‡"],
    // ["?!", "â€½âˆ"],
    // ["!?", "â‰"],
    // ["die", "âš€âšâš‚âšƒâš„âš…"],
    // ["asterisk", "ââ‘â‚âœ¢âœ£âœ¤âœ¥âœ±âœ²âœ³âœºâœ»âœ¼âœ½âƒâ‰âŠâ‹"],
    // ["8<", "âœ‚âœ„"],
    // ["tie", "â€"],
    // ["undertie", "â€¿"],
    // ["apl", "âŒ¶âŒ·âŒ¸âŒ¹âŒºâŒ»âŒ¼âŒ½âŒ¾âŒ¿â€ââ‚âƒâ„â…â†â‡âˆ â‰âŠâ‹âŒâââââ‘â’â“â”â•â–â—â˜â™âšâ› âœâââŸâ â¡â¢â£â¤â¥â¦â§â¨â©âªâ«â¬â­â® â¯â°â±â²â³â´âµâ¶â·â¸â¹âºâ•"],

    // Some combining characters.
    //
    // The following combining characters also have (other)
    // translations:
    // Ì€ Ì Ì‚ Ìƒ Ì„ Ì† Ì‡ Ìˆ Ì‹ ÌŒ Ì£ Ì§ Ì±
    // ["^--" , "Ì…Ì¿"],
    // ["_--" , "Ì²Ì³"],
    // ["^~"  , "ÌƒÍŒ"],
    // ["_~"  , "Ì°"],
    // ["^."  , "Ì‡Ìˆâƒ›âƒœ"],
    // ["_."  , "Ì£Ì¤"],
    // ["^l"  , "âƒ–âƒâƒ”"],
    // ["^l-" , "âƒ–"],
    // ["^r"  , "âƒ—âƒ‘âƒ•"],
    // ["^r-" , "âƒ—"],
    // ["^lr" , "âƒ¡"],
    // ["_lr" , "Í"],
    // ["^^"  , "Ì‚Ì‘Í†"],
    // ["_^"  , "Ì­Ì¯Ìª"],
    // ["^v"  , "ÌŒÌ†"],
    // ["_v"  , "Ì¬Ì®Ìº"],

    // Shorter forms of many greek letters plus Æ›.
    ["Ga", "Î±"],
    ["GA", "Î‘"],
    ["Gb", "Î²"],
    ["GB", "Î’"],
    ["Gg", "Î³"],
    ["GG", "Î“"],
    ["Gd", "Î´"],
    ["GD", "Î”"],
    ["Ge", "Îµ"],
    ["GE", "Î•"],
    ["Gz", "Î¶"],
    ["GZ", "Î–"],
    ["Gth", "Î¸"],
    ["GTH", "Î˜"],
    ["Gi", "Î¹"],
    ["GI", "Î™"],
    ["Gk", "Îº"],
    ["GK", "Îš"],
    ["Gl", "Î»"],
    ["GL", "Î›"],
    ["Gl-", "Æ›"],
    ["Gm", "Î¼"],
    ["GM", "Îœ"],
    ["Gn", "Î½"],
    ["GN", "Î"],
    ["Gx", "Î¾"],
    ["GX", "Î"],
    ["Gr", "Ï"],
    ["GR", "Î¡"],
    ["Gs", "Ïƒ"],
    ["GS", "Î£"],
    ["Gt", "Ï„"],
    ["GT", "Î¤"],
    ["Gu", "Ï…"],
    ["GU", "Î¥"],
    ["Gf", "Ï†"],
    ["GF", "Î¦"],
    ["Gc", "Ï‡"],
    ["GC", "Î§"],
    ["Gp", "Ïˆ"],
    ["GP", "Î¨"],
    ["Go", "Ï‰"],
    ["GO", "Î©"],

    // Mathematical characters
    // ["MiA", "ğ´"], ["MiB", "ğµ"], ["MiC", "ğ¶"], ["MiD", "ğ·"],
    // ["MiE", "ğ¸"], ["MiF", "ğ¹"], ["MiG", "ğº"], ["MiH", "ğ»"],
    // ["MiI", "ğ¼"], ["MiJ", "ğ½"], ["MiK", "ğ¾"], ["MiL", "ğ¿"],
    // ["MiM", "ğ‘€"], ["MiN", "ğ‘"], ["MiO", "ğ‘‚"], ["MiP", "ğ‘ƒ"],
    // ["MiQ", "ğ‘„"], ["MiR", "ğ‘…"], ["MiS", "ğ‘†"], ["MiT", "ğ‘‡"],
    // ["MiU", "ğ‘ˆ"], ["MiV", "ğ‘‰"], ["MiW", "ğ‘Š"], ["MiX", "ğ‘‹"],
    // ["MiY", "ğ‘Œ"], ["MiZ", "ğ‘"],
    // ["Mia", "ğ‘"], ["Mib", "ğ‘"], ["Mic", "ğ‘"], ["Mid", "ğ‘‘"],
    // ["Mie", "ğ‘’"], ["Mif", "ğ‘“"], ["Mig", "ğ‘”"],
    // ["Mii", "ğ‘–"], ["Mij", "ğ‘—"], ["Mik", "ğ‘˜"], ["Mil", "ğ‘™"],
    // ["Mim", "ğ‘š"], ["Min", "ğ‘›"], ["Mio", "ğ‘œ"], ["Mip", "ğ‘"],
    // ["Miq", "ğ‘"], ["Mir", "ğ‘Ÿ"], ["Mis", "ğ‘ "], ["Mit", "ğ‘¡"],
    // ["Miu", "ğ‘¢"], ["Miv", "ğ‘£"], ["Miw", "ğ‘¤"], ["Mix", "ğ‘¥"],
    // ["Miy", "ğ‘¦"], ["Miz", "ğ‘§"],
    // ["MIA", "ğ‘¨"], ["MIB", "ğ‘©"], ["MIC", "ğ‘ª"], ["MID", "ğ‘«"],
    // ["MIE", "ğ‘¬"], ["MIF", "ğ‘­"], ["MIG", "ğ‘®"], ["MIH", "ğ‘¯"],
    // ["MII", "ğ‘°"], ["MIJ", "ğ‘±"], ["MIK", "ğ‘²"], ["MIL", "ğ‘³"],
    // ["MIM", "ğ‘´"], ["MIN", "ğ‘µ"], ["MIO", "ğ‘¶"], ["MIP", "ğ‘·"],
    // ["MIQ", "ğ‘¸"], ["MIR", "ğ‘¹"], ["MIS", "ğ‘º"], ["MIT", "ğ‘»"],
    // ["MIU", "ğ‘¼"], ["MIV", "ğ‘½"], ["MIW", "ğ‘¾"], ["MIX", "ğ‘¿"],
    // ["MIY", "ğ’€"], ["MIZ", "ğ’"],
    // ["MIa", "ğ’‚"], ["MIb", "ğ’ƒ"], ["MIc", "ğ’„"], ["MId", "ğ’…"],
    // ["MIe", "ğ’†"], ["MIf", "ğ’‡"], ["MIg", "ğ’ˆ"], ["MIh", "ğ’‰"],
    // ["MIi", "ğ’Š"], ["MIj", "ğ’‹"], ["MIk", "ğ’Œ"], ["MIl", "ğ’"],
    // ["MIm", "ğ’"], ["MIn", "ğ’"], ["MIo", "ğ’"], ["MIp", "ğ’‘"],
    // ["MIq", "ğ’’"], ["MIr", "ğ’“"], ["MIs", "ğ’”"], ["MIt", "ğ’•"],
    // ["MIu", "ğ’–"], ["MIv", "ğ’—"], ["MIw", "ğ’˜"], ["MIx", "ğ’™"],
    // ["MIy", "ğ’š"], ["MIz", "ğ’›"],
    // ["McA", "ğ’œ"], ["McB", "â„¬"], ["McC", "ğ’"], ["McD", "ğ’Ÿ"],
    // ["McE", "â„°"], ["McF", "â„±"], ["McG", "ğ’¢"], ["McH", "â„‹"],
    // ["McI", "â„"], ["McJ", "ğ’¥"], ["McK", "ğ’¦"], ["McL", "â„’"],
    // ["McM", "â„³"], ["McN", "ğ’©"], ["McO", "ğ’ª"], ["McP", "ğ’«"],
    // ["McQ", "ğ’¬"], ["McR", "â„›"], ["McS", "ğ’®"], ["McT", "ğ’¯"],
    // ["McU", "ğ’°"], ["McV", "ğ’±"], ["McW", "ğ’²"], ["McX", "ğ’³"],
    // ["McY", "ğ’´"], ["McZ", "ğ’µ"],
    // ["Mca", "ğ’¶"], ["Mcb", "ğ’·"], ["Mcc", "ğ’¸"], ["Mcd", "ğ’¹"],
    // ["Mce", "â„¯"], ["Mcf", "ğ’»"], ["Mcg", "â„Š"], ["Mch", "ğ’½"],
    // ["Mci", "ğ’¾"], ["Mcj", "ğ’¿"], ["Mck", "ğ“€"], ["Mcl", "ğ“"],
    // ["Mcm", "ğ“‚"], ["Mcn", "ğ“ƒ"], ["Mco", "â„´"], ["Mcp", "ğ“…"],
    // ["Mcq", "ğ“†"], ["Mcr", "ğ“‡"], ["Mcs", "ğ“ˆ"], ["Mct", "ğ“‰"],
    // ["Mcu", "ğ“Š"], ["Mcv", "ğ“‹"], ["Mcw", "ğ“Œ"], ["Mcx", "ğ“"],
    // ["Mcy", "ğ“"], ["Mcz", "ğ“"],
    // ["MCA", "ğ“"], ["MCB", "ğ“‘"], ["MCC", "ğ“’"], ["MCD", "ğ““"],
    // ["MCE", "ğ“”"], ["MCF", "ğ“•"], ["MCG", "ğ“–"], ["MCH", "ğ“—"],
    // ["MCI", "ğ“˜"], ["MCJ", "ğ“™"], ["MCK", "ğ“š"], ["MCL", "ğ“›"],
    // ["MCM", "ğ“œ"], ["MCN", "ğ“"], ["MCO", "ğ“"], ["MCP", "ğ“Ÿ"],
    // ["MCQ", "ğ“ "], ["MCR", "ğ“¡"], ["MCS", "ğ“¢"], ["MCT", "ğ“£"],
    // ["MCU", "ğ“¤"], ["MCV", "ğ“¥"], ["MCW", "ğ“¦"], ["MCX", "ğ“§"],
    // ["MCY", "ğ“¨"], ["MCZ", "ğ“©"],
    // ["MCa", "ğ“ª"], ["MCb", "ğ“«"], ["MCc", "ğ“¬"], ["MCd", "ğ“­"],
    // ["MCe", "ğ“®"], ["MCf", "ğ“¯"], ["MCg", "ğ“°"], ["MCh", "ğ“±"],
    // ["MCi", "ğ“²"], ["MCj", "ğ“³"], ["MCk", "ğ“´"], ["MCl", "ğ“µ"],
    // ["MCm", "ğ“¶"], ["MCn", "ğ“·"], ["MCo", "ğ“¸"], ["MCp", "ğ“¹"],
    // ["MCq", "ğ“º"], ["MCr", "ğ“»"], ["MCs", "ğ“¼"], ["MCt", "ğ“½"],
    // ["MCu", "ğ“¾"], ["MCv", "ğ“¿"], ["MCw", "ğ”€"], ["MCx", "ğ”"],
    // ["MCy", "ğ”‚"], ["MCz", "ğ”ƒ"],
    // ["MfA", "ğ”„"], ["MfB", "ğ”…"], ["MfD", "ğ”‡"], ["MfE", "ğ”ˆ"],
    // ["MfF", "ğ”‰"], ["MfG", "ğ”Š"], ["MfJ", "ğ”"], ["MfK", "ğ”"],
    // ["MfL", "ğ”"], ["MfM", "ğ”"], ["MfN", "ğ”‘"], ["MfO", "ğ”’"],
    // ["MfP", "ğ”“"], ["MfQ", "ğ””"], ["MfS", "ğ”–"], ["MfT", "ğ”—"],
    // ["MfU", "ğ”˜"], ["MfV", "ğ”™"], ["MfW", "ğ”š"], ["MfX", "ğ”›"],
    // ["MfY", "ğ”œ"],
    // ["Mfa", "ğ”"], ["Mfb", "ğ”Ÿ"], ["Mfc", "ğ” "], ["Mfd", "ğ”¡"],
    // ["Mfe", "ğ”¢"], ["Mff", "ğ”£"], ["Mfg", "ğ”¤"], ["Mfh", "ğ”¥"],
    // ["Mfi", "ğ”¦"], ["Mfj", "ğ”§"], ["Mfk", "ğ”¨"], ["Mfl", "ğ”©"],
    // ["Mfm", "ğ”ª"], ["Mfn", "ğ”«"], ["Mfo", "ğ”¬"], ["Mfp", "ğ”­"],
    // ["Mfq", "ğ”®"], ["Mfr", "ğ”¯"], ["Mfs", "ğ”°"], ["Mft", "ğ”±"],
    // ["Mfu", "ğ”²"], ["Mfv", "ğ”³"], ["Mfw", "ğ”´"], ["Mfx", "ğ”µ"],
    // ["Mfy", "ğ”¶"], ["Mfz", "ğ”·"],

    // (Sub / Super) scripts
    ["_1", "â‚"],
    ["_2", "â‚‚"],
    ["_3", "â‚ƒ"],
    ["_4", "â‚„"],

    // ["_a", "â‚"],
    // ["_e", "â‚‘"],
    // ["_h", "â‚•"],
    ["_i", "áµ¢"],
    ["_j", "â±¼"],
    ["_k", "â‚–"],
    // ["_l", "â‚—"],
    ["_m", "â‚˜"],
    ["_n", "â‚™"],
    // ["_o", "â‚’"],
    // ["_p", "â‚š"],
    // ["_r", "áµ£"],
    // ["_s", "â‚›"],
    // ["_t", "â‚œ"],
    // ["_u", "áµ¤"],
    // ["_x", "â‚“"],

    // ["^a", "áµƒ"],
    // ["^b", "áµ‡"],
    // ["^c", "á¶œ"],
    // ["^d", "áµˆ"],
    // ["^e", "áµ‰"],
    // ["^f", "á¶ "],
    // ["^g", "áµ"],
    // ["^h", "Ê°"],
    // ["^i", "â±"],
    // ["^j", "Ê²"],
    // ["^k", "áµ"],
    // ["^l", "Ë¡"],
    // ["^m", "áµ"],
    ["^n", "â¿"],
    // ["^o", "áµ’"],
    // ["^p", "áµ–"],
    // ["^r", "Ê³"],
    ["^s", "Ë¢"],
    // ["^t", "áµ—"],
    // ["^u", "áµ˜"],
    // ["^v", "áµ›"],
    // ["^w", "Ê·"],
    // ["^x", "Ë£"],
    // ["^y", "Ê¸"],
    // ["^z", "á¶»"],

    // ["^A", "á´¬"], ["^B", "á´®"], ["^D", "á´°"],
    // ["^E", "á´±"], ["^G", "á´³"], ["^H", "á´´"],
    // ["^I", "á´µ"], ["^J", "á´¶"], ["^K", "á´·"], ["^L", "á´¸"],
    // ["^M", "á´¹"], ["^N", "á´º"], ["^O", "á´¼"], ["^P", "á´¾"],
    // ["^R", "á´¿"], ["^T", "áµ€"], ["^U", "áµ"], ["^V", "â±½"],
    // ["^W", "áµ‚"],

    // Some ISO8859-1 characters.
    // [" ", "Â "],
    // ["!", "Â¡"],
    // ["cent", "Â¢"],
    // ["brokenbar", "Â¦"],
    // ["degree", "Â°"],
    // ["?", "Â¿"],
    // ["^a_", "Âª"],
    // ["^o_", "Âº"],

    // Circled, parenthesised etc. numbers and letters.
    // ["(0)", " â“ª"],
    // ["(1)", "â‘´â‘ â’ˆâ¶â€âŠ"], ["(2)", "â‘µâ‘¡â’‰â·ââ‹"], ["(3)", "â‘¶â‘¢â’Šâ¸â‚âŒ"],
    // ["(4)", "â‘·â‘£â’‹â¹âƒâ"], ["(5)", "â‘¸â‘¤â’Œâºâ„â"], ["(6)", "â‘¹â‘¥â’â»â…â"],
    // ["(7)", "â‘ºâ‘¦â’â¼â†â"], ["(8)", "â‘»â‘§â’â½â‡â‘"], ["(9)", "â‘¼â‘¨â’â¾âˆâ’"],
    // ["(10)", "â‘½â‘©â’‘â¿â‰â“"], ["(11)", "â‘¾â‘ªâ’’"], ["(12)", "â‘¿â‘«â’“"],
    // ["(13)", "â’€â‘¬â’”"], ["(14)", "â’â‘­â’•"], ["(15)", "â’‚â‘®â’–"],
    // ["(16)", "â’ƒâ‘¯â’—"], ["(17)", "â’„â‘°â’˜"], ["(18)", "â’…â‘±â’™"],
    // ["(19)", "â’†â‘²â’š"], ["(20)", "â’‡â‘³â’›"],
    //
    // ["(a)", "â’œâ’¶â“"], ["(b)", "â’â’·â“‘"], ["(c)", "â’â’¸â“’"], ["(d)", "â’Ÿâ’¹â““"],
    // ["(e)", "â’ â’ºâ“”"], ["(f)", "â’¡â’»â“•"], ["(g)", "â’¢â’¼â“–"], ["(h)", "â’£â’½â“—"],
    // ["(i)", "â’¤â’¾â“˜"], ["(j)", "â’¥â’¿â“™"], ["(k)", "â’¦â“€â“š"], ["(l)", "â’§â“â“›"],
    // ["(m)", "â’¨â“‚â“œ"], ["(n)", "â’©â“ƒâ“"], ["(o)", "â’ªâ“„â“"], ["(p)", "â’«â“…â“Ÿ"],
    // ["(q)", "â’¬â“†â“ "], ["(r)", "â’­â“‡â“¡"], ["(s)", "â’®â“ˆâ“¢"], ["(t)", "â’¯â“‰â“£"],
    // ["(u)", "â’°â“Šâ“¤"], ["(v)", "â’±â“‹â“¥"], ["(w)", "â’²â“Œâ“¦"], ["(x)", "â’³â“â“§"],
    // ["(y)", "â’´â“â“¨"], ["(z)", "â’µâ“â“©"],
  ]);

  // Returns CodeMirror hint function.
  // TODO Doesn't seem to work for some characters like `(`
  const createHint = table => (editor, _options) => {
    const cur = editor.getCursor();
    const curPos = { line: cur.line, ch: cur.ch };
    const matchEnd = { line: cur.line, ch: cur.ch };
    // Match backwards from the cursor to the back slash.
    let match = "";
    while (curPos.ch >= 0) {
      --curPos.ch;
      match = editor.getRange(curPos, matchEnd);
      if (match[0] === "\\") break;
    }

    const matchStart = curPos;
    const insertFun = (cm, _self, data) =>
      cm.replaceRange(data.symbol, matchStart, matchEnd);

    const list = [];
    for (const obj of table) {
      if (obj.text.startsWith(match)) {
        obj.hint = insertFun;
        list.push(obj);
      }
    }

    return { list: list, from: matchStart, to: matchEnd };
  };

  // TODO Is it possible to disable running this hook in other modes?
  CodeMirror.defineInitHook(function(cm) {
    cm.addKeyMap({
      "\\": function(cm) {
        cm.replaceSelection("\\");
        cm.execCommand("autocomplete");
      },
    });

    const cmplOpt = cm.getOption("hintOptions") || {};
    cmplOpt["extraKeys"] = {
      // Complete using space
      Space: function(cm) {
        const cA = cm.state.completionActive;
        if (cA) {
          cA.widget.pick();
          cm.replaceSelection(" ");
        }
      },
    };
    cm.setOption("hintOptions", cmplOpt);
  });

  CodeMirror.registerGlobalHelper(
    "hint",
    "agda-input",
    // only enable in agda mode for now
    (mode, cm) => mode && mode.name === "agda",
    createHint(translations)
  );

}));
